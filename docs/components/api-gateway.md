# API Gateway

## Overview

This document describes the API Gateway component used to expose the
service HTTP API defined in the API Contract.

API Gateway acts as a **boundary component** between external clients
and the internal service implementation.

Its responsibility is limited to request routing, basic protocol
handling and integration with backend compute.

See:
- [API Contract – v1](../api/api-contract-v1.md)

---

## Responsibilities

API Gateway is responsible for:

- Exposing the HTTP endpoints defined in the API contract
- Handling HTTP request and response semantics
- Routing requests to the appropriate backend Lambda functions
- Enforcing basic request size limits
- Providing request-level observability (logs and metrics)

API Gateway is NOT responsible for:

- Business logic
- Event validation beyond basic protocol checks
- Idempotency enforcement
- Persistence or data access
- Authorization or authentication (v1)

---

## API Type

The service uses **Amazon API Gateway – HTTP API**.

### Rationale

HTTP APIs are selected over REST APIs because they:

- Provide lower latency
- Have lower cost
- Offer native integration with Lambda
- Are sufficient for the simple request/response patterns of v1

Advanced features such as request validation models, usage plans
or API keys are intentionally not used in v1.

---

## API Structure

### Base Path and Versioning

All endpoints are exposed under a versioned base path:

/v1

This versioning is part of the external API contract and allows
future incompatible changes to be introduced safely.

---

## Endpoints

API Gateway exposes the following routes, as defined in the [API Contract – v1](../api/api-contract-v1.md):

- POST /v1/events
- GET  /v1/events/{event_id}

API Gateway does not alter request paths or payloads beyond
basic protocol handling.

---

## Integration Model

### Backend Integration

Each endpoint is integrated with a dedicated AWS Lambda function:

- POST /v1/events → ingestion Lambda
- GET  /v1/events/{event_id} → read Lambda

The integration uses **Lambda proxy integration**, allowing the
Lambda functions to receive the full request context and
return structured HTTP responses.

---

### Request Handling

API Gateway forwards to Lambda:

- HTTP method
- Path parameters
- Query parameters
- Headers
- Raw JSON body

No transformation or enrichment is performed at the API Gateway layer.

---

### Response Handling

Lambda functions are responsible for:

- Determining response status codes
- Producing response bodies
- Returning error responses consistent with the API contract

API Gateway forwards responses to the client without modification.

---

## Limits and Timeouts

### Request Size

API Gateway enforces a maximum request payload size of 256 KB.

Requests exceeding this limit are rejected at the boundary
before reaching backend Lambda functions.

---

### Timeout

- API Gateway timeout: default HTTP API limits
- Lambda timeout is configured independently

Timeout values are selected to ensure fast failure for clients and
prevent long-running requests at the boundary.

---

## Error Handling

API Gateway distinguishes between:

- Client-side protocol errors (malformed HTTP requests)
- Backend errors returned by Lambda

All application-level errors are generated by Lambda and returned
to clients according to the API contract.

---

## Observability

API Gateway provides:

- Access logs for incoming requests
- Metrics for request count, latency and error rates

Request-level correlation identifiers may be propagated via headers
to downstream components for tracing purposes.

Detailed application logs are produced by backend Lambda functions.

---

## Security Considerations (v1)

In v1, the API Gateway:

- Does not enforce authentication or authorization
- Is intended for internal or controlled usage

Future versions may introduce:

- Authentication mechanisms
- Authorization policies
- Rate limiting and throttling

These concerns are explicitly out of scope for v1.

---

## Relationship to Other Components

- The API Gateway implements the HTTP API defined in:
  API Contract – v1
- Business logic and validation are handled by backend Lambdas
- Persistent storage is handled by the Persistence component

API Gateway does not maintain state and can be scaled independently.

---

## Versioning

This document describes the API Gateway configuration used
to implement the v1 HTTP API.

Changes to the API Gateway that do not affect the external
API contract may be applied without version changes.
